<view class="detail-container">
  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 错误提示 -->
  <view wx:elif="{{error}}" class="error">
    <image src="/assets/icons/error.png" mode="aspectFit"></image>
    <text>{{error}}</text>
    <button class="retry-btn" bindtap="loadWorkOrderDetail">重试</button>
  </view>

  <!-- 顶部状态和工单信息合并 -->
  <view class="order-header">
    <view class="order-status {{workOrder.status}}">
      {{workOrder.statusText}}
    </view>
    <view class="order-info">
      <text>工单编号：{{workOrder.id}}</text>
      <!-- 其他信息 -->
    </view>
  </view>

  <!-- 工单详情 -->
  <block wx:elif="{{workOrder}}">
    <!-- 工单基本信息 -->
    <view class="info-card">
      <view class="info-row">
        <text class="info-label">楼栋</text>
        <text class="info-value">{{workOrder.buildingInfo}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">联系电话</text>
        <text class="info-value">{{workOrder.submitterPhone || '未提供'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">问题描述</text>
        <text class="info-value description">{{workOrder.description}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">地址</text>
        <text class="info-value">{{workOrder.address || '未提供'}}</text>
      </view>
      
    </view>

    <!-- 工单图片 -->
    <view class="image-card" wx:if="{{workOrder.imageUrls}}">
      <text class="card-title">问题图片</text>
      <scroll-view class="image-scroll" scroll-x enable-flex>
        <block wx:for="{{workOrder.imageUrls}}" wx:key="index">
          <image
            class="order-image"
            src="{{item}}"
            mode="aspectFill"
            bindtap="previewImage"
            data-type="workOrder"
            data-index="{{index}}"
          />
        </block>
      </scroll-view>
    </view>

    <!-- 处理信息 -->
    <view class="info-card" wx:if="{{workOrder.handledBy}}">
      <text class="card-title">处理信息</text>
      <view class="info-row">
        <text class="info-label">处理人</text>
        <text class="info-value">{{workOrder.handlerName || '未知'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">联系电话</text>
        <text class="info-value">{{workOrder.handlerPhone || '未提供'}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">处理说明</text>
        <text class="info-value description">{{workOrder.handledDesc}}</text>
      </view>
      <view class="info-row">
        <text class="info-label">处理时间</text>
        <text class="info-value">{{workOrder.updatedAt}}</text>
      </view>
    </view>

    <!-- 处理图片 -->
    <view class="image-card" wx:if="{{workOrder.handledImages}}">
      <text class="card-title">处理图片</text>
      <scroll-view class="image-scroll" scroll-x enable-flex>
        <block wx:for="{{workOrder.handledImages}}" wx:key="index">
          <image
            class="order-image"
            src="{{item}}"
            mode="aspectFill"
            bindtap="previewImage"
            data-type="handled"
            data-index="{{index}}"
          />
        </block>
      </scroll-view>
    </view>

    <!-- 处理记录 -->
    <view class="process-record">
      <view class="process-item">
        <text>用户提交工单</text>
        <text class="process-time">{{workOrder.createdAt}}</text>
      </view>
    </view>

    <!-- 反馈信息 -->
    <view class="feedback-card" wx:if="{{workOrder.feedbackList.length > 0}}">
      <text class="card-title">反馈信息</text>
      <view class="feedback-list">
        <view class="feedback-item" wx:for="{{workOrder.feedbackList}}" wx:key="feedbackId">
          <view class="feedback-header">
            <text class="handler">{{item.handlerRole}}</text>
            <text class="time">{{item.feedbackTime}}</text>
          </view>
          <text class="description">{{item.feedbackDescription}}</text>
          <scroll-view class="image-scroll" scroll-x enable-flex wx:if="{{item.feedbackImages}}">
            <block wx:for="{{item.feedbackImages}}" wx:key="index">
              <image
                class="feedback-image"
                src="{{item}}"
                mode="aspectFill"
                bindtap="previewImage"
                data-type="feedback"
                data-index="{{index}}"
              />
            </block>
          </scroll-view>
        </view>
      </view>
    </view>
  </block>

  <!-- 返回按钮 -->
  <button class="back-btn" bindtap="goBack">返回</button>
</view> 