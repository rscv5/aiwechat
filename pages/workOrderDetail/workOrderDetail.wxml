<view class="detail-container">
  <!-- 主标题 -->
  <view class="main-title">
    工单详情
    <view class="main-title-underline"></view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{isLoading}}" class="loading">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 错误提示 -->
  <view wx:elif="{{error}}" class="error">
    <image src="/assets/icons/error.png" mode="aspectFit"></image>
    <text>{{error}}</text>
    <button class="retry-btn" bindtap="loadWorkOrderDetail">重试</button>
  </view>

  <!-- 顶部状态卡片 -->
  <view class="order-header" wx:if="{{workOrder}}">
    <view class="order-status-tag {{statusClass}}">
      {{workOrder.status || '未知状态'}}
    </view>
    <view class="order-info">
      <text>工单编号：{{workOrder.workId}}</text>
    </view>
  </view>

  <!-- 工单详情 -->
  <block wx:if="{{workOrder}}">
    <!-- 工单基本信息 -->
    <view class="info-card">
      <view class="info-tag">
        <image class="info-icon" src="../../assets/icons/building.png" mode="aspectFit" />
        <text>楼栋</text>
        <text class="info-value">{{workOrder.buildingInfo}}</text>
      </view>
      <view class="info-tag">
        <image class="info-icon" src="../../assets/icons/phone.png" mode="aspectFit" />
        <text>联系电话</text>
        <text class="info-value">{{workOrder.submitterPhone || '未提供'}}</text>
      </view>
      <view class="info-tag">
        <image class="info-icon" src="../../assets/icons/desc.png" mode="aspectFit" />
        <text>问题描述</text>
        <text class="info-value">{{workOrder.description}}</text>
      </view>
      <view class="info-tag">
        <image class="info-icon" src="../../assets/icons/location.png" mode="aspectFit" />
        <text>地址</text>
        <text class="info-value">{{workOrder.address || '未提供'}}</text>
      </view>
    </view>

    <!-- 工单图片 -->
    <view class="image-card">
      <text class="card-title">问题图片</text>
      <block wx:if="{{workOrder.imageUrls}}">
        <scroll-view class="image-scroll" scroll-x enable-flex>
          <block wx:for="{{workOrder.imageUrls}}" wx:key="index">
            <image
              class="order-image"
              src="{{item}}"
              mode="aspectFill"
              bindtap="previewImage"
              data-type="workOrder"
              data-index="{{index}}"
            />
          </block>
        </scroll-view>
      </block>
      <block wx:else>
        <view class="image-placeholder">
          <image src="../../assets/icons/no-image.png" class="placeholder-icon" mode="aspectFit" />
          <text class="placeholder-text">暂无图片</text>
        </view>
      </block>
    </view>

    <!-- 时间线操作记录 -->
    <view class="process-record" wx:if="{{workOrder.processingLogs && workOrder.processingLogs.length}}">
      <text class="card-title">操作记录</text>
      <view class="timeline">
        <block wx:for="{{workOrder.processingLogs}}" wx:key="workId">
          <view class="timeline-item">
            <view class="timeline-dot">
              <image class="timeline-icon" src="{{getProcessIcon(item.actionType || item.status)}}" mode="aspectFit" />
            </view>
            <view class="timeline-content">
              <view class="timeline-row">
                <text class="description">{{item.actionDescription}}</text>
                <text class="timeline-time-label">{{item.createdAt || item.updatedAt || 'no time'}}</text>
              </view>
            </view>
          </view>
        </block>
      </view>
    </view>

    <!-- 反馈信息 -->
    <view class="feedback-card" wx:if="{{workOrder.feedbackList.length > 0}}">
      <text class="card-title">反馈信息</text>
      <view class="feedback-list">
        <view class="feedback-item" wx:for="{{workOrder.feedbackList}}" wx:key="feedbackId">
          <view class="feedback-header">
            <text class="handler">{{item.handlerRole}}</text>
            <text class="time">{{item.feedbackTime}}</text>
          </view>
          <text class="description">{{item.feedbackDescription}}</text>
          <scroll-view class="image-scroll" scroll-x enable-flex wx:if="{{item.feedbackImages}}">
            <block wx:for="{{item.feedbackImages}}" wx:key="index">
              <image
                class="feedback-image"
                src="{{item}}"
                mode="aspectFill"
                bindtap="previewImage"
                data-type="feedback"
                data-index="{{index}}"
              />
            </block>
          </scroll-view>
        </view>
      </view>
    </view>
  </block>

  <!-- 返回按钮 -->
  <view class="footer-bar">
    <button class="back-btn" bindtap="goBack">返回</button>
  </view>
</view> 